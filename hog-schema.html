<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Högschema Centrerat Horisontellt</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Teko:wght@300..700&family=Sedgwick+Ave&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      margin: 0;
      background-color: #000;
      font-family: 'Teko', sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 250px 0;
      gap: 50px;
    }

    .match-wrapper {
      position: relative;
      width: 100%;
      height: 150px;
      filter: drop-shadow(4px 4px 10px rgba(0, 0, 0, 1));
    }

    .vs-result {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Sedgwick Ave', cursive;
      font-size: 50px;
      font-weight: bold;
      text-align: center;
      color: #a3e635;
      display: flex;
      justify-content: center;
      align-items: center;
      white-space: nowrap;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.9);
    }

    .team-a, .team-b {
      position: absolute;
      top: 50%;
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateY(-50%);
    }

    .team-a { right: calc(50% + 100px); flex-direction: row; }
    .team-b { left: calc(50% + 100px); flex-direction: row; }

    .team-name {
      font-weight: 600;
      font-size: 75px;
      white-space: nowrap;
      max-width: 670px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .team-logo {
      width: 140px;
      height: 120px;
      object-fit: contain;
      background-color: transparent;
    }

    .extra-info {
      text-align: center;
      font-size: 26px;
      color: #ffffff;
      margin-top: 6px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .twitch-info {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .twitch-icon {
      width: 28px;
      height: 28px;
      fill: #9146FF;
      vertical-align: middle;
    }

    .twitch-name {
      color: #ffffff;
      font-weight: 600;
      font-size: 26px;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div id="matches"></div>

  <script>
    const SHEET_ID = '1GByjCuMMZSxk9EyvJ3ImA385UGYiKyl4oZgeEJq-XAA';
    const BASE = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=`;
    const MATCHES_URL = BASE + "SchemaData";
    const LOGOS_URL = BASE + "Logotabell";

    let logos = {};

    function loadLogos() {
      Papa.parse(LOGOS_URL, {
        download: true,
        header: true,
        complete: function(results) {
          results.data.forEach(row => { logos[row['Lag']] = row['Länk']; });
          loadMatches();
        }
      });
    }

    function createMatchElement(match) {
      const logoA = logos[match['Lag A']] || 'logos/Placeholder.png';
      const logoB = logos[match['Lag B']] || 'logos/Placeholder.png';
      const scoreA = match['Score A'] || '';
      const scoreB = match['Score B'] || '';
      const resultText = (scoreA || scoreB) ? `${scoreA} - ${scoreB}` : "VS";

      const wrapper = document.createElement('div');
      wrapper.className = 'match-wrapper';

      const vs = document.createElement('div');
      vs.className = 'vs-result';
      vs.textContent = resultText;

      const teamA = document.createElement('div');
      teamA.className = 'team-a';
      teamA.innerHTML = `<div class="team-name">${match['Lag A'] || ''}</div><img class="team-logo" src="${logoA}" alt="">`;

      const teamB = document.createElement('div');
      teamB.className = 'team-b';
      teamB.innerHTML = `<img class="team-logo" src="${logoB}" alt=""><div class="team-name">${match['Lag B'] || ''}</div>`;

      wrapper.appendChild(vs);
      wrapper.appendChild(teamA);
      wrapper.appendChild(teamB);

      if (match['Tid'] || match['Format'] || match['Twitch']) {
        const extra = document.createElement('div');
        extra.className = 'extra-info';

        let infoHTML = '';

        if (match['Tid']) infoHTML += `${match['Tid']} `;
        if (match['Format']) infoHTML += `${match['Format']} `;

        if (match['Twitch']) {
          const twitchName = match['Twitch'].replace("https://twitch.tv/", "").trim();
          infoHTML += `
            <span class="twitch-info">
              <svg class="twitch-icon" viewBox="0 0 512 512">
                <path d="M80 32L48 96v320h112v64h64l64-64h96l80-80V32H80zm336 256l-48 48h-96l-64 64v-64H112V80h304v208zM272 144h32v96h-32zm80 0h32v96h-32z"/>
              </svg>
              <span class="twitch-name">${twitchName}</span>
            </span>
          `;
        }

        extra.innerHTML = infoHTML.trim();
        wrapper.appendChild(extra);
      }

      return wrapper;
    }

    function autoscaleText(element, maxFontSize = 75, minFontSize = 16) {
      if (element.dataset.fontsize) return;
      const parentWidth = element.parentElement.offsetWidth;
      let fontSize = maxFontSize;
      element.style.fontSize = fontSize + "px";
      while (element.scrollWidth > parentWidth && fontSize > minFontSize) {
        fontSize--;
        element.style.fontSize = fontSize + "px";
      }
      element.dataset.fontsize = element.style.fontSize;
    }

    function loadMatches() {
      Papa.parse(MATCHES_URL, {
        download: true,
        header: true,
        complete: function(results) {
          const container = document.getElementById('matches');

          results.data.forEach(match => {
            if (match['Visa'] && match['Visa'].toLowerCase() === 'true') {
              const existing = Array.from(container.children).find(wrapper => {
                return wrapper.querySelector('.team-a .team-name').textContent === match['Lag A'] &&
                       wrapper.querySelector('.team-b .team-name').textContent === match['Lag B'];
              });

              if (existing) {
                const vs = existing.querySelector('.vs-result');
                vs.textContent = (match['Score A'] || match['Score B']) ? `${match['Score A'] || ''} - ${match['Score B'] || ''}` : "VS";

                const extra = existing.querySelector('.extra-info');
                if (extra) {
                  let infoHTML = '';
                  if (match['Tid']) infoHTML += `${match['Tid']} `;
                  if (match['Format']) infoHTML += `${match['Format']} `;
                  if (match['Twitch']) {
                    const twitchName = match['Twitch'].replace("https://twitch.tv/", "").trim();
                    infoHTML += `
                      <span class="twitch-info">
                        <svg class="twitch-icon" viewBox="0 0 512 512">
                          <path d="M80 32L48 96v320h112v64h64l64-64h96l80-80V32H80zm336 256l-48 48h-96l-64 64v-64H112V80h304v208zM272 144h32v96h-32zm80 0h32v96h-32z"/>
                        </svg>
                        <span class="twitch-name">${twitchName}</span>
                      </span>
                    `;
                  }
                  extra.innerHTML = infoHTML.trim();
                }
              } else {
                const newElem = createMatchElement(match);
                container.appendChild(newElem);
                newElem.querySelectorAll('.team-name').forEach(el => autoscaleText(el));
              }
            }
          });
        }
      });
    }

    loadLogos();
    setInterval(loadLogos, 30000);
  </script>
</body>
</html>
