<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Matchschema</title>
  <style>
    body {
      margin: 0;
      background: transparent;
      font-family: Arial, sans-serif;
    }

    .schedule-container {
      position: absolute;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
    }

    .match-box {
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      border-radius: 10px;
      padding: 15px;
      width: 400px;
      height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: all 0.3s ease;
    }

    .match-box.next {
      width: 600px;
      border: 2px solid gold;
      box-shadow: 0 0 15px gold;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      font-size: 18px;
      font-weight: bold;
    }

    .teams {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .team {
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 45%;
    }

    .team img {
      height: 40px;
      width: 40px;
      object-fit: contain;
    }

    .score {
      font-size: 24px;
      font-weight: bold;
    }

    .maps {
      display: none;
      margin-top: 10px;
      font-size: 14px;
      line-height: 1.4;
    }

    .match-box.next .maps {
      display: block;
    }
  </style>
</head>
<body>
  <div class="schedule-container" id="schedule"></div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const sheetId = "1Fjlv7GXe2eU0oFRJC3ubNhuxnYa0KIFgngrqlUcA5lY";
    const bracketUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=BracketData`;
    const logosUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Logotabell`;

    let logos = {};

    // Steg 1: Läs in logotabellen
    Papa.parse(logosUrl, {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(row => {
          logos[row["Lagnamn"]] = row["Logotyp"];
        });
        loadMatches();
      }
    });

    // Steg 2: Läs in schemamatcher
    function loadMatches() {
      Papa.parse(bracketUrl, {
        download: true,
        header: true,
        complete: function(results) {
          const matches = results.data.filter(row => row["Schema"]?.trim() === "✔️").slice(0, 3);
          renderMatches(matches);
        }
      });
    }

    // Steg 3: Rendera 3 matchboxar
    function renderMatches(matches) {
      const container = document.getElementById("schedule");
      container.innerHTML = "";

      matches.forEach(match => {
        const isNext = match["Nästa"]?.trim() === "✔️";
        const box = document.createElement("div");
        box.className = "match-box" + (isNext ? " next" : "");

        box.innerHTML = `
          <div class="top-row">
            <div>${match["Match"]}</div>
            <div>${match["Tid"]} – ${match["Format"]}</div>
          </div>
          <div class="teams">
            <div class="team">
              <img src="${logos[match["Lag A"]] || ''}" alt="${match["Lag A"]}">
              <div>${match["Lag A"]}</div>
            </div>
            <div class="score">${match["Score A"]} – ${match["Score B"]}</div>
            <div class="team" style="flex-direction: row-reverse; text-align: right;">
              <img src="${logos[match["Lag B"]] || ''}" alt="${match["Lag B"]}">
              <div>${match["Lag B"]}</div>
            </div>
          </div>
          <div class="maps">
            <div>${match["Karta1"] || ""}</div>
            <div>${match["Karta2"] || ""}</div>
            <div>${match["Karta3"] || ""}</div>
          </div>
        `;
        container.appendChild(box);
      });
    }
  </script>
</body>
</html>
