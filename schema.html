<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schema</title>
  <style>
    body {
      margin: 0;
      background: transparent;
      font-family: sans-serif;
    }

    #match-container {
      position: fixed;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      z-index: 10;
    }

    .match-box {
      background: #111;
      color: white;
      border-radius: 12px;
      padding: 10px 20px;
      width: 400px;
      height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .match-box.next {
      width: 600px;
      border: 4px solid yellow;
      box-shadow: 0 0 20px yellow;
    }

    .match-header {
      display: flex;
      justify-content: space-between;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .teams {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .team {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100px;
      text-align: center;
    }

    .team-logo {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 5px;
    }

    .score {
      font-size: 18px;
      font-weight: bold;
    }

    .maps {
      margin-top: 10px;
      display: flex;
      justify-content: space-around;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div id="match-container"></div>

  <!-- ✅ Först: Ladda PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <!-- ✅ Sedan: Kör all JS när Papa är laddad -->
  <script>
    const sheetID = "1gxZCHqFgXrhv_BMHfOLZymp0pDbP5BghNgPry8dI-R0";
    const schemaURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&sheet=Schema`;
    const logoURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&sheet=Logotabell`;

    let logoMap = {};

    Papa.parse(logoURL, {
      download: true,
      header: true,
      complete: function (results) {
        results.data.forEach(row => {
          if (row.Lag && row.Logo) {
            logoMap[row.Lag.trim()] = row.Logo.trim();
          }
        });
        fetchMatchData();
      }
    });

    function fetchMatchData() {
      Papa.parse(schemaURL, {
        download: true,
        header: true,
        complete: function (results) {
          const data = results.data;
          const stages = ["QF", "SF", "F"];
          const container = document.getElementById("match-container");
          container.innerHTML = "";

          stages.forEach(stage => {
            const match = data.find(row => row.Stage === stage);
            if (!match) return;

            const box = document.createElement("div");
            box.className = "match-box";
            const isNext = match.Nästa && match.Nästa.toLowerCase() === "ja";
            if (isNext) box.classList.add("next");

            box.innerHTML = `
              <div class="match-header">
                <span>${match.Stage}</span>
                <span>${match.Tid || ""} • ${match.Format || ""}</span>
              </div>
              <div class="teams">
                <div class="team">
                  <img class="team-logo" src="${logoMap[match.Lag1] || ''}" />
                  <div>${match.Lag1 || ""}</div>
                  <div class="score">${match.Score1 || 0}</div>
                </div>
                <div class="team">
                  <img class="team-logo" src="${logoMap[match.Lag2] || ''}" />
                  <div>${match.Lag2 || ""}</div>
                  <div class="score">${match.Score2 || 0}</div>
                </div>
              </div>
              ${isNext ? `
                <div class="maps">
                  <div>${match.Karta1 || ''}</div>
                  <div>${match.Karta2 || ''}</div>
                  <div>${match.Karta3 || ''}</div>
                </div>
              ` : ``}
            `;
            container.appendChild(box);
          });
        }
      });
    }
  </script>
</body>
</html>
